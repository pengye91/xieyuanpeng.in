<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   Made with Remarkable!
  </title>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <style type="text/css">
   h1,h2,h3,h4{color:#6495ed}body,table tr{background-color:#fff}table tr td,table tr th{border:1px solid #ccc;text-align:left;padding:6px 13px;margin:0}pre code,table,table tr{padding:0}body{font-family:Helvetica,Arial,sans-serif}h1,h2{text-align:center}blockquote{background:#f9f9f9;border-left:10px solid #6495ed;margin:1.5em 10px;padding:.5em 10px;font-style:italic}blockquote p{display:inline}hr{clear:both;float:none;width:100%;height:2.5px;margin:1.4em 0;border:none;background:#ddd;background:-webkit-gradient(linear,left bottom,right bottom,color-stop(0,#fff),color-stop(.1,#ddd),color-stop(.9,#ddd),color-stop(1,#fff)) #ddd;background:-moz-linear-gradient(left center,#fff 0,#ddd 10%,#ddd 90%,#fff 100%) #ddd}table tr{border-top:1px solid #ccc;margin:0}table tr:nth-child(2n){background-color:#aaa}table tr th{font-weight:700}table tr td :first-child,table tr th :first-child{margin-top:0}table tr td:last-child,table tr th :last-child{margin-bottom:0}code,tt{margin:0 2px;padding:0 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}pre code{margin:0;white-space:pre;border:none;background:0 0}.highlight pre,pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}
  </style>
 </head>
 <body>
  <p>
   ﻿[TOC]
  </p>
  <h1 id="intro">
   Intro
  </h1>
  <h4 id="20161010phase_i">
   从今天(2016.10.10)开始,每天一个笔记记录当天所做的和Phase_I相关的工作和想法.
  </h4>
  <hr/>
  <h1 id="day-1">
   Day 1
  </h1>
  <h4 id="_1">
   今天讨论了接下来两个半月的工作:
  </h4>
  <p>
   1.只关心第一阶段的东西,不讨论第二阶段甚至以后的特性.
  </p>
  <p>
   2.将原型的数据库重新设计,仅使用原型的操作逻辑.
  </p>
  <p>
   3.按照自己的想法在某些不合理的地方做修改
  </p>
  <h4 id="_2">
   今天学会了:
  </h4>
  <ul>
   <li>
    通过allauth初步学习了signal的使用方法.
   </li>
  </ul>
  <h4 id="_3">
   今天思考了:
  </h4>
  <ul>
   <li>
    <p>
     在数据库设计中,使用一个User表来保存所有的用户的用户信息.
    </p>
   </li>
   <li>
    <p>
     一个Patient表来保存所有的病人的信息,并用onetoonefield来指向user
    </p>
   </li>
   <li>
    <p>
     Physician表同理
    </p>
   </li>
   <li>
    <p>
     在注册时username表示的是电话号码,
     <strong>
      <em>
       在注册时
      </em>
     </strong>
     这个值是唯一的,email也是
    </p>
   </li>
   <li>
    <p>
     在登录时,都以这个值作为唯一标识,但是可以设置两个登录入口,一个是医生入口,一个是病人入口
    </p>
   </li>
   <li>
    <p>
     从医生入口登录的用户具有Physician表的实例, 从病人入口登录的用户具有Patient实例(
     <strong>
      <em>
       或许可以使用get_or_create方法
      </em>
     </strong>
     )
    </p>
   </li>
  </ul>
  <hr/>
  <h1 id="day-2">
   Day 2
  </h1>
  <h4 id="userprofile">
   今天要完成UserProfile的工作
  </h4>
  <h4 id="solved">
   遇到的问题
   <font color="red">
    (solved)
   </font>
   :
  </h4>
  <ul>
   <li>
    <p>
     <code>
      __str__ return Nonetype
     </code>
     : 这是因为匿名用户的true_name是个空值,返回值必然是NoneType,在
     <code>
      guardian.management.__init__.py
     </code>
     文件中添加
     <code>
      true_name
     </code>
     字段的值就行了.
    </p>
   </li>
   <li>
   </li>
  </ul>
  <h4 id="not-solved-yet">
   遇到的问题
   <font color="red">
    (not solved yet)
   </font>
   :
  </h4>
  <ul>
   <li>
    <p>
     进入用户修改信息页面将用户类型修改后, 希望能自动判断相应的用户类型是否存在并在数据库中修改.(
     <font color="red">
      solved
     </font>
     ).由于在更新后总会返回到detailview里,所以在detailview里判断,但这会造成
     <font color="red">
      下面的问题
     </font>
     :
    </p>
   </li>
   <li>
    <p>
     在detailview中代码如下:
    </p>
   </li>
  </ul>
  <pre><code class="python">def get_object(self):
    request_user = User.objects.get(username=self.request.user.username)
        if request_user.user_type == 'DOC' and not Physician.objects.filter(user=request_user).exists():
            Physician.objects.create(user=request_user)
        elif request_user.user_type == 'PAT' and not Patient.objects.filter(user=request_user).exists():
            Patient.objects.create(user=request_user)
    return request_use
</code></pre>
  <p>
   这会造成每次进入detailview页面都要检索数据库的窘境.(
   <font color="red">
    to be solved
   </font>
   )
  </p>
  <h4 id="_4">
   明天要做的:
  </h4>
  <ul>
   <li>
    <p>
     分类:
    </p>
    <ul>
     <li>
      <p>
       医生入口和病人入口
      </p>
     </li>
     <li>
      <p>
       这两种入口都需要重新登录
      </p>
     </li>
     <li>
      <p>
       登陆后显示自己的相关信息
      </p>
     </li>
     <li>
      <p>
       先解决医生入口
      </p>
     </li>
    </ul>
    <hr/>
    <h1 id="day-3">
     Day 3
    </h1>
   </li>
  </ul>
  <h4 id="class-based-view-model">
   首先要解决一个class based view 里使用多个model的问题:
  </h4>
  <pre><code>-&lt;font color=red&gt; [点我点我](http://stackoverflow.com/questions/12187751/django-pass-multiple-models-to-one-template)&lt;/font&gt;

- 重点在于使用```get_context_data```函数

- 但是这个并没有解决在updateview中一次submit存储多个表的问题,解决见下:
</code></pre>
  <h3 id="_5">
   <font color="red">
    解决
   </font>
  </h3>
  <p>
   通过一个
   <a href="http://django-betterforms.readthedocs.io/en/latest/">
    模块
   </a>
   (betterforms)完美解决
  </p>
  <h4 id="_6">
   遇到另一个问题
  </h4>
  <ul>
   <li>
    不能上传图片(
    <font color="red">
     solved
    </font>
    )
    <ul>
     <li>
      在form中要确保有
      <font color="red">
       <code>
        enctype="multipart/form-data"
       </code>
      </font>
     </li>
    </ul>
   </li>
  </ul>
  <hr/>
  <h1 id="day-4">
   Day 4
  </h1>
  <h4 id="todo">
   <font color="red">
    TODO:
   </font>
  </h4>
  <ul>
   <li>
    优化数据库查询语句,现在有太多的duplicate query了.
   </li>
  </ul>
  <h4 id="_7">
   今天做了:
  </h4>
  <ul>
   <li>
    <p>
     大致完善了医生数据库的设计(其实差得还远)
    </p>
   </li>
   <li>
    <p>
     好像只做了这些
    </p>
   </li>
  </ul>
  <h4 id="_8">
   明天要做
  </h4>
  <ul>
   <li>
    医生病人分离
   </li>
  </ul>
  <h4 id="_9">
   今天没遇到什么问题
  </h4>
  <hr/>
  <h1 id="day-5">
   Day 5
  </h1>
  <h4 id="html">
   今天调整了页面html的部分设置:
  </h4>
  <ul>
   <li>
    <p>
     可以按照用户id来识别,而不是手机号
    </p>
   </li>
   <li>
    <p>
     修改了一些views(其实是记不到了
    </p>
   </li>
  </ul>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>